'use client';
import{__rest as e}from"tslib";import{jsxs as o,Fragment as r,jsx as i}from"react/jsx-runtime";import{ModalGroup as t}from"./ModalGroup/ModalGroup.js";import{useModalGroupContext as s}from"./ModalGroup/ModalGroup.context.js";import{useMergeRefs as l,FloatingPortal as a}from"@floating-ui/react";import{useFocusTrap as n}from"../../hooks/use-focus-trap.hook.js";import{useKeypress as c}from"../../hooks/use-keypress.js";import{useComponentTheme as m}from"../../theme/theme.context.js";import{usePropId as d}from"../../utils/usePropId.js";import{forwardRef as u,useRef as p,useState as y,useMemo as f,useEffect as h}from"react";import v from"../Overlay/Overlay.js";import{twMerge as b}from"tailwind-merge";const O={closeOnEscape:!0,color:"white",mode:"dialog",open:!1,overlayBlur:"sm",overlayCloseOnClick:!0,overlayColor:"dark",overlayOpacity:"50",position:"top",radius:"md",shadow:"base",size:"sm"},g=u(((t,u)=>{const g=m("Modal"),j=Object.assign(Object.assign({},O),t),{children:C,className:k="",closeOnEscape:w,color:x,mode:M,onClose:N,open:E,overlayBlur:G,overlayCloseOnClick:z,overlayColor:Y,overlayOpacity:B,position:I,radius:A,shadow:K,size:P}=j,R=e(j,["children","className","closeOnEscape","color","mode","onClose","open","overlayBlur","overlayCloseOnClick","overlayColor","overlayOpacity","position","radius","shadow","size"]),T=d(t.id),$=p(null),[q,D]=y(!1),F=n(q),H=l([$,F||null,u||null]),J=p(null),{activeModalId:L,registry:Q,setRegistry:S}=s(),U=f((()=>{if("fullscreen"===M)return"0%";switch(I){case"top":case"bottom":return"0%";default:return"-50%"}}),[I,M]);h((()=>{if(!S||!Q||!$.current)return;const e=E?[...Q,$.current]:Q.filter((e=>e!==$.current));if(S(e),0!==e.length&&!E&&e.length<Q.length){e[e.length-1].animate([{opacity:0,transform:"translateY(-50px)",visibility:"hidden"},{opacity:1,transform:"translateY(0%)",visibility:"visible"}],{duration:150}),D(!1)}}),[E]);const V=f((()=>b(g({className:k,color:x,mode:M,position:I,radius:A,shadow:K,size:P}))),[k,x,M,I,A,K,P,g]);c("Escape",w,N);return h((()=>{const e=E?"ease-in-out":"ease-out",o=E?150:100,r=new KeyframeEffect($.current,[{opacity:0,transform:"translateY(-100px)",visibility:"hidden"},{opacity:1,transform:`translateY(${U})`,visibility:"visible"}],{duration:o,fill:"both",easing:e});J.current=new Animation(r,document.timeline)}),[E,$]),h((()=>{J.current&&(E?(J.current.play(),J.current.onfinish=()=>{D(!0)}):(J.current.reverse(),D(!1)))}),[E]),h((()=>{J.current&&(L===T?setTimeout((()=>{D(!0)}),100):D(!1))}),[L]),o(r,{children:["fullscreen"!==M&&i(v,{open:E,onClick:()=>{z&&N&&N()},blur:G,color:Y,opacity:B,closeOnClick:z}),i(a,{children:i("div",Object.assign({className:"flex justify-center"},{children:i("div",Object.assign({id:T,role:"dialog","aria-modal":"true","aria-hidden":!E,style:{opacity:0,visibility:"hidden"},ref:H,className:V},R,{children:C}))}))})]})}));g.displayName="Modal";const j=Object.assign(g,{Group:t});export{j as default};
